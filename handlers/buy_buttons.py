from aiogram import Router, F
from aiogram.types import CallbackQuery
from aiogram.fsm.context import FSMContext
from handlers.buy_form import Buy

router = Router()


# ---------- КАК ПРОЙТИ ТЕСТ ----------
@router.callback_query(F.data == "buy_test_help")
async def buy_test_help(callback: CallbackQuery):
    text = (
        "Небольшие подсказки по тематике теста:\n\n"

        "• В начале теста идут вопросы о вашем личном опыте инвестирования. "
        "Тут нет правильных или неправильных ответов — важно просто указать, как есть.\n\n"

        "• Когда речь идёт о кредитном рейтинге — обычно под этим понимают оценку того, насколько компания "
        "способна выполнять свои финансовые обязательства. Такие оценки дают именно рейтинговые агентства.\n\n"

        "• В части вопросов о торгах на рынке ценных бумаг важный момент: любая сделка совершается только "
        "если есть та сторона, которая готова купить или продать. Поэтому заранее невозможно точно определить "
        "момент заключения сделки — всё зависит от наличия встречных заявок.\n\n"

        "• Если где-то упоминается ликвидность, то обычно более ликвидные бумаги торгуются с меньшим "
        "разбросом между ценами покупки и продажи. Чем активнее торгуемость, тем уже спред.\n\n"

        "• Если выпуск облигаций не имеет кредитного рейтинга, то это просто означает отсутствие мнения "
        "рейтингового агентства по уровню риска конкретно этого выпуска."
    )

    await callback.message.answer(text)
    await callback.answer()

# ---------- ЗАВЕРШИТЬ ПОКУПКУ ----------
@router.callback_query(F.data == "buy_finish")
async def buy_finish(callback: CallbackQuery, state: FSMContext):
    await callback.message.answer(
        "Отлично! Теперь укажите номер заявки:"
    )
    await state.set_state(Buy.waiting_for_order)
    await callback.answer()
